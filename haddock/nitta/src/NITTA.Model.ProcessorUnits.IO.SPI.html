<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-comment">{- |
Module      : NITTA.Model.ProcessorUnits.IO.SPI
Description :
Copyright   : (c) Aleksandr Penskoi, 2019
License     : BSD3
Maintainer  : aleksandr.penskoi@gmail.com
Stability   : experimental
-}</span><span>
</span><span id="line-20"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NITTA.Model.ProcessorUnits.IO.SPI</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier">SPI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#anySPI"><span class="hs-identifier">anySPI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Ports"><span class="hs-identifier">Ports</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOPorts"><span class="hs-identifier">IOPorts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#spiMasterPorts"><span class="hs-identifier">spiMasterPorts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#spiSlavePorts"><span class="hs-identifier">spiSlavePorts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String.Interpolate</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Functions.html"><span class="hs-identifier">NITTA.Intermediate.Functions</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html"><span class="hs-identifier">NITTA.Intermediate.Types</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.html"><span class="hs-identifier">NITTA.Model.Problems</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html"><span class="hs-identifier">NITTA.Model.ProcessorUnits.IO.SimpleIO</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html"><span class="hs-identifier">NITTA.Model.ProcessorUnits.Types</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html"><span class="hs-identifier">NITTA.Model.Time</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Project.html"><span class="hs-identifier">NITTA.Project</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Utils.html"><span class="hs-identifier">NITTA.Utils</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter</span></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">data</span><span> </span><span id="SPIinterface"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIinterface"><span class="hs-identifier hs-var">SPIinterface</span></a></span></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIOInterface"><span class="hs-identifier hs-type">SimpleIOInterface</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIinterface"><span class="hs-identifier hs-type">SPIinterface</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">type</span><span> </span><span id="SPI"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-var">SPI</span></a></span></span><span> </span><span id="local-6989586621680038442"><span class="annot"><a href="#local-6989586621680038442"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680038441"><span class="annot"><a href="#local-6989586621680038441"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680038440"><span class="annot"><a href="#local-6989586621680038440"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIO"><span class="hs-identifier hs-type">SimpleIO</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIinterface"><span class="hs-identifier hs-type">SPIinterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038442"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038441"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038440"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span id="local-6989586621680038556"><span id="local-6989586621680038557"><span id="local-6989586621680038558"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#anySPI"><span class="hs-identifier hs-type">anySPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Time.html#Time"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038558"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038557"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038556"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038558"><span class="hs-identifier hs-type">t</span></a></span></span></span></span><span>
</span><span id="line-53"></span><span id="anySPI"><span class="annot"><span class="annottext">anySPI :: Int -&gt; Maybe Int -&gt; SPI v x t
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#anySPI"><span class="hs-identifier hs-var hs-var">anySPI</span></a></span></span><span> </span><span id="local-6989586621680038439"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680038439"><span class="hs-identifier hs-var">bounceFilter</span></a></span></span><span> </span><span id="local-6989586621680038438"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621680038438"><span class="hs-identifier hs-var">bufferSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="annottext">SimpleIO :: forall i v x t.
Int
-&gt; Maybe Int
-&gt; [Q v x]
-&gt; Int
-&gt; Bool
-&gt; [Q v x]
-&gt; Int
-&gt; Process t (StepInfo v x t)
-&gt; SimpleIO i v x t
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIO"><span class="hs-identifier hs-type">SimpleIO</span></a></span><span>
</span><span id="line-55"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Int
$sel:bounceFilter:SimpleIO :: Int
bounceFilter :: Int
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#%24sel%3AbounceFilter%3ASimpleIO"><span class="hs-identifier hs-var hs-var">bounceFilter</span></a></span><span>
</span><span id="line-56"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Int
$sel:bufferSize:SimpleIO :: Maybe Int
bufferSize :: Maybe Int
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#%24sel%3AbufferSize%3ASimpleIO"><span class="hs-identifier hs-var hs-var">bufferSize</span></a></span><span>
</span><span id="line-57"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:receiveQueue:SimpleIO :: [Q v x]
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#%24sel%3AreceiveQueue%3ASimpleIO"><span class="hs-identifier hs-var">receiveQueue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-58"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:receiveN:SimpleIO :: Int
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#%24sel%3AreceiveN%3ASimpleIO"><span class="hs-identifier hs-var">receiveN</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-59"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:isReceiveOver:SimpleIO :: Bool
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#%24sel%3AisReceiveOver%3ASimpleIO"><span class="hs-identifier hs-var">isReceiveOver</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-60"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:sendQueue:SimpleIO :: [Q v x]
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#%24sel%3AsendQueue%3ASimpleIO"><span class="hs-identifier hs-var">sendQueue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-61"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:sendN:SimpleIO :: Int
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#%24sel%3AsendN%3ASimpleIO"><span class="hs-identifier hs-var">sendN</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-62"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:process_:SimpleIO :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#%24sel%3Aprocess_%3ASimpleIO"><span class="hs-identifier hs-var">process_</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-63"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span id="local-6989586621680038425"><span id="local-6989586621680038426"><span id="local-6989586621680038427"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680038421"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOConnected"><span class="hs-identifier hs-type">IOConnected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038427"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038426"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038425"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-keyword">data</span><span> </span><span id="IOPorts"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOPorts"><span class="hs-identifier hs-var">IOPorts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038427"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038426"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038425"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="SPIMaster"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-var">SPIMaster</span></a></span></span><span>
</span><span id="line-68"></span><span>            </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Amaster_mosi%3ASPIMaster"><span class="annot"><span class="annottext">IOPorts (SPI v x t) -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Amaster_mosi%3ASPIMaster"><span class="hs-identifier hs-var hs-var">master_mosi</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-type">OutputPortTag</span></a></span><span>
</span><span id="line-69"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Amaster_miso%3ASPIMaster"><span class="annot"><span class="annottext">IOPorts (SPI v x t) -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Amaster_miso%3ASPIMaster"><span class="hs-identifier hs-var hs-var">master_miso</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-type">InputPortTag</span></a></span><span>
</span><span id="line-70"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Amaster_sclk%3ASPIMaster"><span class="annot"><span class="annottext">IOPorts (SPI v x t) -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Amaster_sclk%3ASPIMaster"><span class="hs-identifier hs-var hs-var">master_sclk</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-type">OutputPortTag</span></a></span><span>
</span><span id="line-71"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Amaster_cs%3ASPIMaster"><span class="annot"><span class="annottext">IOPorts (SPI v x t) -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Amaster_cs%3ASPIMaster"><span class="hs-identifier hs-var hs-var">master_cs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-type">OutputPortTag</span></a></span><span>
</span><span id="line-72"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-73"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="SPISlave"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-var">SPISlave</span></a></span></span><span>
</span><span id="line-74"></span><span>            </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Aslave_mosi%3ASPIMaster"><span class="annot"><span class="annottext">IOPorts (SPI v x t) -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Aslave_mosi%3ASPIMaster"><span class="hs-identifier hs-var hs-var">slave_mosi</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-type">InputPortTag</span></a></span><span>
</span><span id="line-75"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aslave_miso%3ASPIMaster"><span class="annot"><span class="annottext">IOPorts (SPI v x t) -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Aslave_miso%3ASPIMaster"><span class="hs-identifier hs-var hs-var">slave_miso</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-type">OutputPortTag</span></a></span><span>
</span><span id="line-76"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aslave_sclk%3ASPIMaster"><span class="annot"><span class="annottext">IOPorts (SPI v x t) -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Aslave_sclk%3ASPIMaster"><span class="hs-identifier hs-var hs-var">slave_sclk</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-type">InputPortTag</span></a></span><span>
</span><span id="line-77"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aslave_cs%3ASPIMaster"><span class="annot"><span class="annottext">IOPorts (SPI v x t) -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Aslave_cs%3ASPIMaster"><span class="hs-identifier hs-var hs-var">slave_cs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-type">InputPortTag</span></a></span><span>
</span><span id="line-78"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680038404"><span id="local-6989586621680038406"><span id="local-6989586621680038408"><span class="annot"><span class="annottext">Int -&gt; IOPorts (SPI v x t) -&gt; ShowS
[IOPorts (SPI v x t)] -&gt; ShowS
IOPorts (SPI v x t) -&gt; String
(Int -&gt; IOPorts (SPI v x t) -&gt; ShowS)
-&gt; (IOPorts (SPI v x t) -&gt; String)
-&gt; ([IOPorts (SPI v x t)] -&gt; ShowS)
-&gt; Show (IOPorts (SPI v x t))
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v x t. Int -&gt; IOPorts (SPI v x t) -&gt; ShowS
forall v x t. [IOPorts (SPI v x t)] -&gt; ShowS
forall v x t. IOPorts (SPI v x t) -&gt; String
showList :: [IOPorts (SPI v x t)] -&gt; ShowS
$cshowList :: forall v x t. [IOPorts (SPI v x t)] -&gt; ShowS
show :: IOPorts (SPI v x t) -&gt; String
$cshow :: forall v x t. IOPorts (SPI v x t) -&gt; String
showsPrec :: Int -&gt; IOPorts (SPI v x t) -&gt; ShowS
$cshowsPrec :: forall v x t. Int -&gt; IOPorts (SPI v x t) -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>    </span><span id="local-6989586621680038402"><span class="annot"><span class="annottext">inputPorts :: IOPorts (SPI v x t) -&gt; Set InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#inputPorts"><span class="hs-identifier hs-var hs-var hs-var hs-var">inputPorts</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038397"><span id="local-6989586621680038398"><span id="local-6989586621680038399"><span id="local-6989586621680038400"><span class="annot"><a href="#local-6989586621680038397"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[InputPortTag] -&gt; Set InputPortTag
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">InputPortTag
</span><a href="#local-6989586621680038400"><span class="hs-identifier hs-var">slave_mosi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InputPortTag
</span><a href="#local-6989586621680038398"><span class="hs-identifier hs-var">slave_sclk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InputPortTag
</span><a href="#local-6989586621680038397"><span class="hs-identifier hs-var">slave_cs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#inputPorts"><span class="hs-identifier hs-var">inputPorts</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038392"><span id="local-6989586621680038393"><span id="local-6989586621680038394"><span id="local-6989586621680038395"><span class="annot"><a href="#local-6989586621680038392"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[InputPortTag] -&gt; Set InputPortTag
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">InputPortTag
</span><a href="#local-6989586621680038394"><span class="hs-identifier hs-var">master_miso</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621680038391"><span class="annot"><span class="annottext">outputPorts :: IOPorts (SPI v x t) -&gt; Set OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#outputPorts"><span class="hs-identifier hs-var hs-var hs-var hs-var">outputPorts</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038386"><span id="local-6989586621680038387"><span id="local-6989586621680038388"><span id="local-6989586621680038389"><span class="annot"><a href="#local-6989586621680038386"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OutputPortTag] -&gt; Set OutputPortTag
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">OutputPortTag
</span><a href="#local-6989586621680038388"><span class="hs-identifier hs-var">slave_miso</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#outputPorts"><span class="hs-identifier hs-var">outputPorts</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038382"><span id="local-6989586621680038383"><span id="local-6989586621680038384"><span id="local-6989586621680038385"><span class="annot"><a href="#local-6989586621680038382"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OutputPortTag] -&gt; Set OutputPortTag
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">OutputPortTag
</span><a href="#local-6989586621680038385"><span class="hs-identifier hs-var">master_mosi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutputPortTag
</span><a href="#local-6989586621680038383"><span class="hs-identifier hs-var">master_sclk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutputPortTag
</span><a href="#local-6989586621680038382"><span class="hs-identifier hs-var">master_cs</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span id="spiMasterPorts"><span class="annot"><span class="annottext">spiMasterPorts :: Text -&gt; IOPorts (SPI v x t)
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#spiMasterPorts"><span class="hs-identifier hs-var hs-var">spiMasterPorts</span></a></span></span><span> </span><span id="local-6989586621680038381"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038381"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><span class="annottext">SPIMaster :: forall v x t.
OutputPortTag
-&gt; InputPortTag
-&gt; OutputPortTag
-&gt; OutputPortTag
-&gt; IOPorts (SPI v x t)
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:master_mosi:SPIMaster :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Amaster_mosi%3ASPIMaster"><span class="hs-identifier hs-var">master_mosi</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-var">OutputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; OutputPortTag) -&gt; Text -&gt; OutputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038381"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_mosi&quot;</span></span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:master_miso:SPIMaster :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Amaster_miso%3ASPIMaster"><span class="hs-identifier hs-var">master_miso</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-var">InputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; InputPortTag) -&gt; Text -&gt; InputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038381"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_miso&quot;</span></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:master_sclk:SPIMaster :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Amaster_sclk%3ASPIMaster"><span class="hs-identifier hs-var">master_sclk</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-var">OutputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; OutputPortTag) -&gt; Text -&gt; OutputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038381"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_sclk&quot;</span></span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:master_cs:SPIMaster :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Amaster_cs%3ASPIMaster"><span class="hs-identifier hs-var">master_cs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-var">OutputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; OutputPortTag) -&gt; Text -&gt; OutputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038381"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_cs&quot;</span></span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span id="spiSlavePorts"><span class="annot"><span class="annottext">spiSlavePorts :: Text -&gt; IOPorts (SPI v x t)
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#spiSlavePorts"><span class="hs-identifier hs-var hs-var">spiSlavePorts</span></a></span></span><span> </span><span id="local-6989586621680038378"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038378"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><span class="annottext">SPISlave :: forall v x t.
InputPortTag
-&gt; OutputPortTag
-&gt; InputPortTag
-&gt; InputPortTag
-&gt; IOPorts (SPI v x t)
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span>
</span><span id="line-97"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:slave_mosi:SPIMaster :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Aslave_mosi%3ASPIMaster"><span class="hs-identifier hs-var">slave_mosi</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-var">InputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; InputPortTag) -&gt; Text -&gt; InputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038378"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_mosi&quot;</span></span><span>
</span><span id="line-98"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:slave_miso:SPIMaster :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Aslave_miso%3ASPIMaster"><span class="hs-identifier hs-var">slave_miso</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-var">OutputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; OutputPortTag) -&gt; Text -&gt; OutputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038378"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_miso&quot;</span></span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:slave_sclk:SPIMaster :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Aslave_sclk%3ASPIMaster"><span class="hs-identifier hs-var">slave_sclk</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-var">InputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; InputPortTag) -&gt; Text -&gt; InputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038378"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_sclk&quot;</span></span><span>
</span><span id="line-100"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:slave_cs:SPIMaster :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#%24sel%3Aslave_cs%3ASPIMaster"><span class="hs-identifier hs-var">slave_cs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-var">InputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; InputPortTag) -&gt; Text -&gt; InputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038378"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_cs&quot;</span></span><span>
</span><span id="line-101"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span id="local-6989586621680038375"><span id="local-6989586621680038376"><span id="local-6989586621680038377"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Time.html#Time"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038377"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038376"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038375"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038377"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621680038372"><span class="annot"><span class="annottext">def :: SPI v x t
</span><a href="#local-6989586621680038372"><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; SPI v x t
forall t v x. Time t =&gt; Int -&gt; Maybe Int -&gt; SPI v x t
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#anySPI"><span class="hs-identifier hs-var">anySPI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; SPI v x t) -&gt; Maybe Int -&gt; SPI v x t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span></span></span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span id="local-6989586621680038369"><span id="local-6989586621680038370"><span id="local-6989586621680038371"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680038371"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038371"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038370"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038369"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#TargetSystemComponent"><span class="hs-identifier hs-type">TargetSystemComponent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038371"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038370"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038369"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621680038363"><span class="annot"><span class="annottext">moduleName :: Text -&gt; SPI v x t -&gt; Text
</span><a href="NITTA.Project.Types.html#moduleName"><span class="hs-identifier hs-var hs-var hs-var hs-var">moduleName</span></a></span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SPI v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pu_spi&quot;</span></span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621680038361"><span class="annot"><span class="annottext">hardware :: Text -&gt; SPI v x t -&gt; Implementation
</span><a href="NITTA.Project.Types.html#hardware"><span class="hs-identifier hs-var hs-var hs-var hs-var">hardware</span></a></span></span><span> </span><span id="local-6989586621680038359"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038359"><span class="hs-identifier hs-var">_tag</span></a></span></span><span> </span><span id="local-6989586621680038358"><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680038358"><span class="hs-identifier hs-var">_pu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="annottext">Maybe String -&gt; [Implementation] -&gt; Implementation
</span><a href="NITTA.Project.Types.html#Aggregate"><span class="hs-identifier hs-var">Aggregate</span></a></span><span>
</span><span id="line-110"></span><span>            </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-111"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/pu_slave_spi_driver.v&quot;</span></span><span>
</span><span id="line-112"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/spi_slave_driver.v&quot;</span></span><span>
</span><span id="line-113"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/i2n_splitter.v&quot;</span></span><span>
</span><span id="line-114"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/buffer.v&quot;</span></span><span>
</span><span id="line-115"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/bounce_filter.v&quot;</span></span><span>
</span><span id="line-116"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/spi_master_driver.v&quot;</span></span><span>
</span><span id="line-117"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/n2i_splitter.v&quot;</span></span><span>
</span><span id="line-118"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/pu_slave_spi.v&quot;</span></span><span>
</span><span id="line-119"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/pu_master_spi.v&quot;</span></span><span>
</span><span id="line-120"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621680038355"><span class="annot"><span class="annottext">software :: Text -&gt; SPI v x t -&gt; Implementation
</span><a href="NITTA.Project.Types.html#software"><span class="hs-identifier hs-var hs-var hs-var hs-var">software</span></a></span></span><span> </span><span id="local-6989586621680038353"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038353"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680038352"><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680038352"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SPI v x t -&gt; Text -&gt; Implementation
forall i v x t.
(VarValTime v x t, SimpleIOInterface i, ToJSON v) =&gt;
Text -&gt; SimpleIO i v x t -&gt; Text -&gt; Implementation
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#protocolDescription"><span class="hs-identifier hs-var">protocolDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038353"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680038352"><span class="hs-identifier hs-var">pu</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SPI Processor Unit&quot;</span></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621680038350"><span class="annot"><span class="annottext">hardwareInstance :: Text -&gt; SPI v x t -&gt; UnitEnv (SPI v x t) -&gt; Verilog
</span><a href="NITTA.Project.Types.html#hardwareInstance"><span class="hs-identifier hs-var hs-var hs-var hs-var">hardwareInstance</span></a></span></span><span>
</span><span id="line-125"></span><span>        </span><span id="local-6989586621680038348"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038348"><span class="hs-identifier hs-var">tag</span></a></span></span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIO"><span class="hs-identifier hs-type">SimpleIO</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038347"><span class="annot"><span class="annottext">Int
bounceFilter :: Int
$sel:bounceFilter:SimpleIO :: forall i v x t. SimpleIO i v x t -&gt; Int
</span><a href="#local-6989586621680038347"><span class="hs-identifier hs-var hs-var">bounceFilter</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038346"><span class="annot"><span class="annottext">Int
sendN :: Int
$sel:sendN:SimpleIO :: forall i v x t. SimpleIO i v x t -&gt; Int
</span><a href="#local-6989586621680038346"><span class="hs-identifier hs-var hs-var">sendN</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038345"><span class="annot"><span class="annottext">Int
receiveN :: Int
$sel:receiveN:SimpleIO :: forall i v x t. SimpleIO i v x t -&gt; Int
</span><a href="#local-6989586621680038345"><span class="hs-identifier hs-var hs-var">receiveN</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><a href="NITTA.Project.Types.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span>
</span><span id="line-128"></span><span>            </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680038343"><span class="annot"><span class="annottext">Text
sigClk :: forall m. UnitEnv m -&gt; Text
sigClk :: Text
</span><a href="NITTA.Project.Types.html#sigClk"><span class="hs-identifier hs-var hs-var">sigClk</span></a></span></span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038341"><span class="annot"><span class="annottext">Text
sigRst :: forall m. UnitEnv m -&gt; Text
sigRst :: Text
</span><a href="NITTA.Project.Types.html#sigRst"><span class="hs-identifier hs-var hs-var">sigRst</span></a></span></span><span>
</span><span id="line-130"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038339"><span class="annot"><span class="annottext">Text
sigCycleBegin :: forall m. UnitEnv m -&gt; Text
sigCycleBegin :: Text
</span><a href="NITTA.Project.Types.html#sigCycleBegin"><span class="hs-identifier hs-var hs-var">sigCycleBegin</span></a></span></span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038337"><span class="annot"><span class="annottext">Text
sigInCycle :: forall m. UnitEnv m -&gt; Text
sigInCycle :: Text
</span><a href="NITTA.Project.Types.html#sigInCycle"><span class="hs-identifier hs-var hs-var">sigInCycle</span></a></span></span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038335"><span class="annot"><span class="annottext">Text
sigCycleEnd :: forall m. UnitEnv m -&gt; Text
sigCycleEnd :: Text
</span><a href="NITTA.Project.Types.html#sigCycleEnd"><span class="hs-identifier hs-var hs-var">sigCycleEnd</span></a></span></span><span>
</span><span id="line-133"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">valueIn :: forall m. UnitEnv m -&gt; Maybe (Text, Text)
</span><a href="NITTA.Project.Types.html#valueIn"><span class="hs-identifier hs-var">valueIn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680038332"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038332"><span class="hs-identifier hs-var">dataIn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038331"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038331"><span class="hs-identifier hs-var">attrIn</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">valueOut :: forall m. UnitEnv m -&gt; Maybe (Text, Text)
</span><a href="NITTA.Project.Types.html#valueOut"><span class="hs-identifier hs-var">valueOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680038329"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038329"><span class="hs-identifier hs-var">dataOut</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038328"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038328"><span class="hs-identifier hs-var">attrOut</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctrlPorts :: forall m. UnitEnv m -&gt; Maybe (Ports m)
</span><a href="NITTA.Project.Types.html#ctrlPorts"><span class="hs-identifier hs-var">ctrlPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIOPorts"><span class="hs-identifier hs-type">SimpleIOPorts</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038323"><span id="local-6989586621680038324"><span id="local-6989586621680038325"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#%24sel%3Astop%3ASimpleIOPorts"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ioPorts :: forall m. UnitEnv m -&gt; Maybe (IOPorts m)
</span><a href="NITTA.Project.Types.html#ioPorts"><span class="hs-identifier hs-var">ioPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680038318"><span class="annot"><span class="annottext">IOPorts (SPI v x t)
</span><a href="#local-6989586621680038318"><span class="hs-identifier hs-var">ioPorts</span></a></span></span><span>
</span><span id="line-137"></span><span>            </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>            </span><span class="annot"><span class="">[__i|
                #{ module_ ioPorts } \#
                        ( .DATA_WIDTH( #{ dataWidth (def :: x) } )
                        , .ATTR_WIDTH( #{ attrWidth (def :: x) } )
                        , .BOUNCE_FILTER( #{ show bounceFilter } )
                        , .DISABLED( #{ if sendN == 0 &amp;&amp; receiveN == 0 then (1 :: Int) else 0 } )
                        ) #{ tag }
                    ( .clk( #{ sigClk } )
                    , .rst( #{ sigRst } )
                    , .flag_stop( #{ stop } )
                    , .signal_cycle_begin( #{ sigCycleBegin } )
                    , .signal_in_cycle( #{ sigInCycle  } )
                    , .signal_cycle_end( #{ sigCycleEnd } )
                    , .signal_oe( #{ oe } )
                    , .signal_wr( #{ wr } )
                    , .data_in( #{ dataIn } ), .attr_in( #{ attrIn } )
                    , .data_out( #{ dataOut } ), .attr_out( #{ attrOut } )
                    #{ nest 4 $ extIO ioPorts  }
                    );
            |]</span></span><span>
</span><span id="line-158"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>                </span><span id="local-6989586621680038317"><span class="annot"><span class="annottext">module_ :: IOPorts (SPI v x t) -&gt; Verilog
</span><a href="#local-6989586621680038317"><span class="hs-identifier hs-var hs-var">module_</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Verilog
</span><span class="hs-string">&quot;pu_slave_spi&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Utils.html#Verilog"><span class="hs-identifier hs-type">Verilog</span></a></span><span>
</span><span id="line-160"></span><span>                </span><span class="annot"><a href="#local-6989586621680038317"><span class="hs-identifier hs-var">module_</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Verilog
</span><span class="hs-string">&quot;pu_master_spi&quot;</span></span><span>
</span><span id="line-161"></span><span>                </span><span id="local-6989586621680038316"><span class="annot"><span class="annottext">extIO :: IOPorts (SPI v x t) -&gt; Verilog
</span><a href="#local-6989586621680038316"><span class="hs-identifier hs-var hs-var">extIO</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038302"><span id="local-6989586621680038303"><span id="local-6989586621680038304"><span id="local-6989586621680038305"><span class="annot"><a href="#local-6989586621680038302"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>                    </span><span class="annot"><span class="">[__i|
                        , .mosi( #{ slave_mosi } )
                        , .miso( #{ slave_miso } )
                        , .sclk( #{ slave_sclk } )
                        , .cs( #{ slave_cs } )
                    |]</span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-168"></span><span>                        </span><span class="annot"><a href="NITTA.Utils.html#Verilog"><span class="hs-identifier hs-type">Verilog</span></a></span><span>
</span><span id="line-169"></span><span>                </span><span class="annot"><a href="#local-6989586621680038316"><span class="hs-identifier hs-var">extIO</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038298"><span id="local-6989586621680038299"><span id="local-6989586621680038300"><span id="local-6989586621680038301"><span class="annot"><a href="#local-6989586621680038298"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-170"></span><span>                    </span><span class="annot"><span class="">[__i|
                        , .mosi( #{ master_mosi } )
                        , .miso( #{ master_miso } )
                        , .sclk( #{ master_sclk } )
                        , .cs( #{ master_cs } )
                    |]</span></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><a href="NITTA.Project.Types.html#hardwareInstance"><span class="hs-identifier hs-var">hardwareInstance</span></a></span><span> </span><span id="local-6989586621680038297"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038297"><span class="hs-identifier hs-var">_title</span></a></span></span><span> </span><span id="local-6989586621680038296"><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680038296"><span class="hs-identifier hs-var">_pu</span></a></span></span><span> </span><span id="local-6989586621680038295"><span class="annot"><span class="annottext">UnitEnv (SPI v x t)
</span><a href="#local-6989586621680038295"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Verilog
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;internal error&quot;</span></span></span></span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span id="local-6989586621680038291"><span id="local-6989586621680038292"><span id="local-6989586621680038293"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038293"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038292"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038291"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621680038292"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Project.TestBench.html#IOTestBench"><span class="hs-identifier hs-type">IOTestBench</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038293"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038292"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038291"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680038293"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680038292"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621680038287"><span class="annot"><span class="annottext">testEnvironmentInitFlag :: Text -&gt; SPI v x t -&gt; Maybe Text
</span><a href="NITTA.Project.TestBench.html#testEnvironmentInitFlag"><span class="hs-identifier hs-var hs-var hs-var hs-var">testEnvironmentInitFlag</span></a></span></span><span> </span><span id="local-6989586621680038285"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038285"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680038284"><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680038284"><span class="hs-identifier hs-var">_pu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text) -&gt; Text -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038285"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_env_init_flag&quot;</span></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621680038283"><span class="annot"><span class="annottext">testEnvironment :: Text
-&gt; SPI v x t
-&gt; UnitEnv (SPI v x t)
-&gt; TestEnvironment v x
-&gt; Maybe Verilog
</span><a href="NITTA.Project.TestBench.html#testEnvironment"><span class="hs-identifier hs-var hs-var hs-var hs-var">testEnvironment</span></a></span></span><span>
</span><span id="line-182"></span><span>        </span><span id="local-6989586621680038281"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038281"><span class="hs-identifier hs-var">tag</span></a></span></span><span>
</span><span id="line-183"></span><span>        </span><span id="local-6989586621680038280"><span class="annot"><span class="annottext">sio :: SPI v x t
</span><a href="#local-6989586621680038280"><span class="hs-identifier hs-var">sio</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIO"><span class="hs-identifier hs-type">SimpleIO</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038279"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
process_ :: Process t (StepInfo v x t)
$sel:process_:SimpleIO :: forall i v x t. SimpleIO i v x t -&gt; Process t (StepInfo v x t)
</span><a href="#local-6989586621680038279"><span class="hs-identifier hs-var hs-var">process_</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038278"><span class="annot"><span class="annottext">Int
bounceFilter :: Int
$sel:bounceFilter:SimpleIO :: forall i v x t. SimpleIO i v x t -&gt; Int
</span><a href="#local-6989586621680038278"><span class="hs-identifier hs-var hs-var">bounceFilter</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-184"></span><span>        </span><span class="annot"><a href="NITTA.Project.Types.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span>
</span><span id="line-185"></span><span>            </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680038277"><span class="annot"><span class="annottext">Text
sigClk :: Text
sigClk :: forall m. UnitEnv m -&gt; Text
</span><a href="#local-6989586621680038277"><span class="hs-identifier hs-var hs-var">sigClk</span></a></span></span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038276"><span class="annot"><span class="annottext">Text
sigRst :: Text
sigRst :: forall m. UnitEnv m -&gt; Text
</span><a href="#local-6989586621680038276"><span class="hs-identifier hs-var hs-var">sigRst</span></a></span></span><span>
</span><span id="line-187"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctrlPorts :: forall m. UnitEnv m -&gt; Maybe (Ports m)
</span><a href="NITTA.Project.Types.html#ctrlPorts"><span class="hs-identifier hs-var">ctrlPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIOPorts"><span class="hs-identifier hs-type">SimpleIOPorts</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-188"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ioPorts :: forall m. UnitEnv m -&gt; Maybe (IOPorts m)
</span><a href="NITTA.Project.Types.html#ioPorts"><span class="hs-identifier hs-var">ioPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680038275"><span class="annot"><span class="annottext">IOPorts (SPI v x t)
</span><a href="#local-6989586621680038275"><span class="hs-identifier hs-var">ioPorts</span></a></span></span><span>
</span><span id="line-189"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-190"></span><span>        </span><span class="annot"><a href="NITTA.Project.TestBench.html#TestEnvironment"><span class="hs-identifier hs-type">TestEnvironment</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">teCntx :: forall v x. TestEnvironment v x -&gt; Cntx v x
</span><a href="NITTA.Project.TestBench.html#teCntx"><span class="hs-identifier hs-var">teCntx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680038272"><span class="annot"><span class="annottext">cntx :: Cntx v x
</span><a href="#local-6989586621680038272"><span class="hs-identifier hs-var">cntx</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Intermediate.Types.html#Cntx"><span class="hs-identifier hs-type">Cntx</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038270"><span class="annot"><span class="annottext">Int
cntxCycleNumber :: forall v x. Cntx v x -&gt; Int
cntxCycleNumber :: Int
</span><a href="NITTA.Intermediate.Types.html#cntxCycleNumber"><span class="hs-identifier hs-var hs-var">cntxCycleNumber</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038268"><span class="annot"><span class="annottext">[CycleCntx v x]
cntxProcess :: forall v x. Cntx v x -&gt; [CycleCntx v x]
cntxProcess :: [CycleCntx v x]
</span><a href="NITTA.Intermediate.Types.html#cntxProcess"><span class="hs-identifier hs-var hs-var">cntxProcess</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680038266"><span class="annot"><span class="annottext">Int
teComputationDuration :: forall v x. TestEnvironment v x -&gt; Int
teComputationDuration :: Int
</span><a href="NITTA.Project.TestBench.html#teComputationDuration"><span class="hs-identifier hs-var hs-var">teComputationDuration</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680038264"><span class="annot"><span class="annottext">receivedVariablesSeq :: [v]
</span><a href="#local-6989586621680038264"><span class="hs-identifier hs-var hs-var">receivedVariablesSeq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-192"></span><span>                    </span><span class="annot"><span class="annottext">(F v x -&gt; Maybe v) -&gt; [F v x] -&gt; [v]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-193"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680038263"><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680038263"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">F v x -&gt; Maybe (Receive v x)
forall (f :: * -&gt; * -&gt; *) v x.
(Typeable f, Typeable v, Typeable x) =&gt;
F v x -&gt; Maybe (f v x)
</span><a href="NITTA.Intermediate.Types.html#castF"><span class="hs-identifier hs-var">castF</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680038263"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-194"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="NITTA.Intermediate.Functions.html#Receive"><span class="hs-identifier hs-type">Receive</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">v -&gt; Maybe v
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(v -&gt; Maybe v) -&gt; v -&gt; Maybe v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; v
forall c. Set c -&gt; c
</span><a href="NITTA.Utils.Base.html#oneOf"><span class="hs-identifier hs-var">oneOf</span></a></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; v) -&gt; Set v -&gt; v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680038263"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-195"></span><span>                            </span><span class="annot"><span class="annottext">Maybe (Receive v x)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe v
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-196"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>                        </span><span class="annot"><span class="annottext">([F v x] -&gt; [v]) -&gt; [F v x] -&gt; [v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t) -&gt; [F v x]
forall a f. WithFunctions a f =&gt; a -&gt; [f]
</span><a href="NITTA.Intermediate.Types.html#functions"><span class="hs-identifier hs-var">functions</span></a></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680038279"><span class="hs-identifier hs-var">process_</span></a></span><span>
</span><span id="line-198"></span><span>                </span><span id="local-6989586621680038257"><span class="annot"><span class="annottext">receivedVarsValues :: [Map v x]
</span><a href="#local-6989586621680038257"><span class="hs-identifier hs-var hs-var">receivedVarsValues</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Map v x] -&gt; [Map v x]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680038270"><span class="hs-identifier hs-var">cntxCycleNumber</span></a></span><span> </span><span class="annot"><span class="annottext">([Map v x] -&gt; [Map v x]) -&gt; [Map v x] -&gt; [Map v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cntx v x -&gt; [Map v x]
forall v x. Ord v =&gt; Cntx v x -&gt; [Map v x]
</span><a href="NITTA.Intermediate.Types.html#cntxReceivedBySlice"><span class="hs-identifier hs-var">cntxReceivedBySlice</span></a></span><span> </span><span class="annot"><span class="annottext">Cntx v x
</span><a href="#local-6989586621680038272"><span class="hs-identifier hs-var">cntx</span></a></span><span>
</span><span id="line-199"></span><span>                </span><span id="local-6989586621680038254"><span class="annot"><span class="annottext">sendedVariableSeq :: [v]
</span><a href="#local-6989586621680038254"><span class="hs-identifier hs-var hs-var">sendedVariableSeq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>                    </span><span class="annot"><span class="annottext">(EndpointRole v -&gt; Maybe v) -&gt; [EndpointRole v] -&gt; [v]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-201"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-202"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Problems.Endpoint.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span id="local-6989586621680038252"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680038252"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">v -&gt; Maybe v
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680038252"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-203"></span><span>                            </span><span class="annot"><span class="annottext">EndpointRole v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe v
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-204"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>                        </span><span class="annot"><span class="annottext">([EndpointRole v] -&gt; [v]) -&gt; [EndpointRole v] -&gt; [v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t) -&gt; [EndpointRole v]
forall t1 v x t2.
Ord t1 =&gt;
Process t1 (StepInfo v x t2) -&gt; [EndpointRole v]
</span><a href="NITTA.Utils.html#getEndpoints"><span class="hs-identifier hs-var">getEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680038279"><span class="hs-identifier hs-var">process_</span></a></span><span>
</span><span id="line-206"></span><span>                </span><span id="local-6989586621680038250"><span class="annot"><span class="annottext">sendedVarsValues :: [HashMap v x]
</span><a href="#local-6989586621680038250"><span class="hs-identifier hs-var hs-var">sendedVarsValues</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [HashMap v x] -&gt; [HashMap v x]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680038270"><span class="hs-identifier hs-var">cntxCycleNumber</span></a></span><span> </span><span class="annot"><span class="annottext">([HashMap v x] -&gt; [HashMap v x]) -&gt; [HashMap v x] -&gt; [HashMap v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CycleCntx v x -&gt; HashMap v x) -&gt; [CycleCntx v x] -&gt; [HashMap v x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CycleCntx v x -&gt; HashMap v x
forall v x. CycleCntx v x -&gt; HashMap v x
</span><a href="NITTA.Intermediate.Types.html#cycleCntx"><span class="hs-identifier hs-var hs-var">cycleCntx</span></a></span><span> </span><span class="annot"><span class="annottext">[CycleCntx v x]
</span><a href="#local-6989586621680038268"><span class="hs-identifier hs-var">cntxProcess</span></a></span><span>
</span><span id="line-207"></span><span>                </span><span id="local-6989586621680038248"><span class="annot"><span class="annottext">wordWidth :: Int
</span><a href="#local-6989586621680038248"><span class="hs-identifier hs-var hs-var">wordWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x -&gt; Int
forall x. Val x =&gt; x -&gt; Int
</span><a href="NITTA.Intermediate.Value.html#dataWidth"><span class="hs-identifier hs-var">dataWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">x
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680038292"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>                </span><span id="local-6989586621680038247"><span class="annot"><span class="annottext">frameWordCount :: Int
</span><a href="#local-6989586621680038247"><span class="hs-identifier hs-var hs-var">frameWordCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[v] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680038264"><span class="hs-identifier hs-var">receivedVariablesSeq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[v] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680038254"><span class="hs-identifier hs-var">sendedVariableSeq</span></a></span><span>
</span><span id="line-209"></span><span>                </span><span id="local-6989586621680038244"><span class="annot"><span class="annottext">frameWidth :: Int
</span><a href="#local-6989586621680038244"><span class="hs-identifier hs-var hs-var">frameWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680038247"><span class="hs-identifier hs-var">frameWordCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680038248"><span class="hs-identifier hs-var">wordWidth</span></a></span><span>
</span><span id="line-210"></span><span>                </span><span id="local-6989586621680038242"><span class="annot"><span class="annottext">timeLag :: Int
</span><a href="#local-6989586621680038242"><span class="hs-identifier hs-var hs-var">timeLag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-211"></span><span>                </span><span id="local-6989586621680038241"><span class="annot"><span class="annottext">sendingDuration :: Int
</span><a href="#local-6989586621680038241"><span class="hs-identifier hs-var hs-var">sendingDuration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span>
</span><span id="line-213"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680038266"><span class="hs-identifier hs-var">teComputationDuration</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680038244"><span class="hs-identifier hs-var">frameWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680038278"><span class="hs-identifier hs-var">bounceFilter</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>                </span><span id="local-6989586621680038239"><span class="annot"><span class="annottext">toVerilogLiteral :: [x] -&gt; Doc Any
</span><a href="#local-6989586621680038239"><span class="hs-identifier hs-var hs-var">toVerilogLiteral</span></a></span></span><span> </span><span id="local-6989586621680038238"><span class="annot"><span class="annottext">[x]
</span><a href="#local-6989586621680038238"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-217"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680038237"><span class="annot"><span class="annottext">xs' :: [Doc Any]
</span><a href="#local-6989586621680038237"><span class="hs-identifier hs-var hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(x -&gt; Doc Any) -&gt; [x] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">x -&gt; Doc Any
</span><a href="#local-6989586621680038236"><span class="hs-identifier hs-var">toVerilogLiteral'</span></a></span><span> </span><span class="annot"><span class="annottext">[x]
</span><a href="#local-6989586621680038238"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-218"></span><span>                        </span><span id="local-6989586621680038235"><span class="annot"><span class="annottext">placeholder :: [Doc Any]
</span><a href="#local-6989586621680038235"><span class="hs-identifier hs-var hs-var">placeholder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc Any -&gt; [Doc Any]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680038247"><span class="hs-identifier hs-var">frameWordCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">[x] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[x]
</span><a href="#local-6989586621680038238"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="">[i|#{ wordWidth }'d00|]</span></span><span>
</span><span id="line-219"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Doc Any] -&gt; Doc Any
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">hsep</span></span><span> </span><span class="annot"><span class="annottext">([Doc Any] -&gt; Doc Any) -&gt; [Doc Any] -&gt; Doc Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; [Doc Any] -&gt; [Doc Any]
forall ann. Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
</span><span class="hs-identifier hs-var">punctuate</span></span><span> </span><span class="annot"><span class="annottext">Doc Any
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Doc Any]
</span><a href="#local-6989586621680038237"><span class="hs-identifier hs-var">xs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Doc Any] -&gt; [Doc Any] -&gt; [Doc Any]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Doc Any]
</span><a href="#local-6989586621680038235"><span class="hs-identifier hs-var">placeholder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>                </span><span id="local-6989586621680038236"><span class="annot"><span class="annottext">toVerilogLiteral' :: x -&gt; Doc Any
</span><a href="#local-6989586621680038236"><span class="hs-identifier hs-var hs-var">toVerilogLiteral'</span></a></span></span><span> </span><span id="local-6989586621680038231"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680038231"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-221"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">x -&gt; x
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680038231"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">x -&gt; x -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680038231"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[i|-#{ wordWidth }'sd#{ dataLiteral (-x) }|]</span></span><span>
</span><span id="line-222"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[i|#{ wordWidth }'sd#{ dataLiteral x }|]</span></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>                </span><span id="local-6989586621680038227"><span class="annot"><span class="annottext">disable :: Verilog
</span><a href="#local-6989586621680038227"><span class="hs-identifier hs-var hs-var">disable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>                    </span><span class="annot"><span class="">[__i|
                        initial begin
                            @(negedge #{ sigRst });
                            #{ envInitFlagName } &lt;= 1;
                        end
                    |]</span></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680038226"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038226"><span class="hs-identifier hs-var">envInitFlagName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SPI v x t -&gt; Maybe Text
forall pu v x. IOTestBench pu v x =&gt; Text -&gt; pu -&gt; Maybe Text
</span><a href="NITTA.Project.TestBench.html#testEnvironmentInitFlag"><span class="hs-identifier hs-var">testEnvironmentInitFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038281"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680038280"><span class="hs-identifier hs-var">sio</span></a></span><span>
</span><span id="line-233"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IOPorts (SPI v x t)
</span><a href="#local-6989586621680038275"><span class="hs-identifier hs-var">ioPorts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-234"></span><span>                    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038222"><span id="local-6989586621680038223"><span id="local-6989586621680038224"><span id="local-6989586621680038225"><span class="annot"><a href="#local-6989586621680038222"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-235"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680038221"><span class="annot"><span class="annottext">receiveCycle :: Map v x -&gt; Doc Any
</span><a href="#local-6989586621680038221"><span class="hs-identifier hs-var hs-var">receiveCycle</span></a></span></span><span> </span><span id="local-6989586621680038220"><span class="annot"><span class="annottext">Map v x
</span><a href="#local-6989586621680038220"><span class="hs-identifier hs-var">transmit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680038219"><span class="annot"><span class="annottext">xs :: [x]
</span><a href="#local-6989586621680038219"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(v -&gt; x) -&gt; [v] -&gt; [x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680038218"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680038218"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; Maybe x -&gt; x
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">x
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">(Maybe x -&gt; x) -&gt; Maybe x -&gt; x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map v x
</span><a href="#local-6989586621680038220"><span class="hs-identifier hs-var">transmit</span></a></span><span> </span><span class="annot"><span class="annottext">Map v x -&gt; v -&gt; Maybe x
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><span class="hs-operator hs-var">M.!?</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680038218"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680038264"><span class="hs-identifier hs-var">receivedVariablesSeq</span></a></span><span>
</span><span id="line-237"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[__i|
                                        $display( &quot;set data for sending #{ viaShow xs } by #{ tag }_io_test_input&quot; );
                                        #{ tag }_io_test_input = { #{ toVerilogLiteral xs } }; // #{ viaShow xs }
                                        #{ tag }_io_test_start_transaction = 1;                           @(posedge #{ sigClk });
                                        #{ tag }_io_test_start_transaction = 0;                           @(posedge #{ sigClk });
                                        repeat( #{ sendingDuration } ) @(posedge #{ sigClk });

                                    |]</span></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>                            </span><span id="local-6989586621680038215"><span class="annot"><span class="annottext">sendingAssert :: HashMap v x -&gt; Doc Any
</span><a href="#local-6989586621680038215"><span class="hs-identifier hs-var hs-var">sendingAssert</span></a></span></span><span> </span><span id="local-6989586621680038214"><span class="annot"><span class="annottext">HashMap v x
</span><a href="#local-6989586621680038214"><span class="hs-identifier hs-var">transmit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680038213"><span class="annot"><span class="annottext">xs :: [x]
</span><a href="#local-6989586621680038213"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(v -&gt; x) -&gt; [v] -&gt; [x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680038212"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680038212"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; Maybe x -&gt; x
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">x
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">(Maybe x -&gt; x) -&gt; Maybe x -&gt; x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; HashMap v x -&gt; Maybe x
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680038212"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap v x
</span><a href="#local-6989586621680038214"><span class="hs-identifier hs-var">transmit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680038254"><span class="hs-identifier hs-var">sendedVariableSeq</span></a></span><span>
</span><span id="line-248"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[__i|
                                        @(posedge #{ tag }_io_test_start_transaction);
                                            $write( &quot;#{ tag }_io_test_output actual: %H except: %H ({ #{ toVerilogLiteral xs } })&quot;,
                                                #{ tag }_io_test_output, { #{ toVerilogLiteral xs } } );
                                            if ( #{ tag }_io_test_output != { #{ toVerilogLiteral xs } } ) $display(&quot;\t\tFAIL&quot;);
                                            else $display();

                                    |]</span></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>                            </span><span id="local-6989586621680038210"><span class="annot"><span class="annottext">endDeviceInstance :: Verilog
</span><a href="#local-6989586621680038210"><span class="hs-identifier hs-var hs-var">endDeviceInstance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    /*
                                    #{ pretty sio }
                                    */
                                    reg #{ tag }_io_test_start_transaction;
                                    reg  [#{ frameWidth }-1:0] #{ tag }_io_test_input;
                                    wire #{ tag }_io_test_ready;
                                    wire [#{ frameWidth }-1:0] #{ tag }_io_test_output;
                                    initial #{ envInitFlagName } &lt;= 0; // should be defined on the testbench level.
                                    spi_master_driver \#
                                            ( .DATA_WIDTH( #{ frameWidth } )
                                            , .SCLK_HALFPERIOD( 1 )
                                            ) #{ tag }_io_test
                                        ( .clk( #{ sigClk } )
                                        , .rst( #{ sigRst } )
                                        , .start_transaction( #{ tag }_io_test_start_transaction )
                                        , .data_in( #{ tag }_io_test_input )
                                        , .data_out( #{ tag }_io_test_output )
                                        , .ready( #{ tag }_io_test_ready )
                                        , .mosi( #{ slave_mosi } )
                                        , .miso( #{ slave_miso } )
                                        , .sclk( #{ slave_sclk } )
                                        , .cs( #{ slave_cs } )
                                        );
                                    initial #{ tag }_io_test.inner.shiftreg &lt;= 0;
                                |]</span></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>                            </span><span id="local-6989586621680038208"><span class="annot"><span class="annottext">envDeviceControl :: Verilog
</span><a href="#local-6989586621680038208"><span class="hs-identifier hs-var hs-var">envDeviceControl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    initial begin
                                        #{ tag }_io_test_start_transaction &lt;= 0;
                                        #{ tag }_io_test_input &lt;= 0;
                                        @(negedge #{ sigRst });
                                        repeat(#{ timeLag }) @(posedge #{ sigClk });

                                        #{ nest 4 $ vsep $ map receiveCycle receivedVarsValues }
                                        repeat ( 5 ) begin
                                            #{ nest 8 $ receiveCycle def }
                                        end

                                        // $finish; // DON'T DO THAT (with this line test can pass without data checking)
                                    end
                                |]</span></span><span>
</span><span id="line-301"></span><span>                            </span><span id="local-6989586621680038206"><span class="annot"><span class="annottext">envDeviceCheck :: Verilog
</span><a href="#local-6989586621680038206"><span class="hs-identifier hs-var hs-var">envDeviceCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    initial begin
                                        @(negedge #{ sigRst });
                                        repeat ( OUTPUT_LATENCY ) @(posedge #{ tag }_io_test_start_transaction); // latency

                                        #{ nest 4 $ vsep $ map sendingAssert sendedVarsValues }
                                        forever begin
                                            @(posedge spi_io_test_start_transaction);
                                            $display( &quot;#{ tag }_io_test_output actual: %H&quot;, #{ tag }_io_test_output );
                                        end
                                    end
                                |]</span></span><span>
</span><span id="line-314"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- FIXME: do not check output signals when we drop data</span><span>
</span><span id="line-315"></span><span>                            </span><span class="annot"><span class="annottext">Verilog -&gt; Maybe Verilog
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-316"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    ////////////////////////////////////////
                                    // SPI test environment
                                    localparam NITTA_LATENCY = 1;
                                    localparam OUTPUT_LATENCY = 3;

                                    // SPI device in test environment
                                    #{ endDeviceInstance :: Verilog }

                                    // SPI device in test environment control
                                    #{ if frameWordCount == 0 then disable else envDeviceControl }

                                    // SPI device in test environment check
                                    #{ if frameWordCount == 0 then disable else envDeviceCheck }

                                    // SPI environment initialization flag set
                                    initial begin
                                        repeat ( NITTA_LATENCY ) @(posedge spi_io_test_start_transaction);
                                        spi_env_init_flag &lt;= 1;
                                    end
                                |]</span></span><span>
</span><span id="line-337"></span><span>                    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span class="hs-special">{</span><span id="local-6989586621680038202"><span id="local-6989586621680038203"><span id="local-6989586621680038204"><span id="local-6989586621680038205"><span class="annot"><a href="#local-6989586621680038202"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-338"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680038201"><span class="annot"><span class="annottext">receiveCycle :: Map v x -&gt; Doc Any
</span><a href="#local-6989586621680038201"><span class="hs-identifier hs-var hs-var">receiveCycle</span></a></span></span><span> </span><span id="local-6989586621680038200"><span class="annot"><span class="annottext">Map v x
</span><a href="#local-6989586621680038200"><span class="hs-identifier hs-var">transmit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-339"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680038199"><span class="annot"><span class="annottext">xs :: [x]
</span><a href="#local-6989586621680038199"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(v -&gt; x) -&gt; [v] -&gt; [x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680038198"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680038198"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; Maybe x -&gt; x
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">x
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">(Maybe x -&gt; x) -&gt; Maybe x -&gt; x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map v x
</span><a href="#local-6989586621680038200"><span class="hs-identifier hs-var">transmit</span></a></span><span> </span><span class="annot"><span class="annottext">Map v x -&gt; v -&gt; Maybe x
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><span class="hs-operator hs-var">M.!?</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680038198"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680038264"><span class="hs-identifier hs-var">receivedVariablesSeq</span></a></span><span>
</span><span id="line-340"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[__i|
                                        #{ tag }_io_test_input = { #{ toVerilogLiteral xs } }; // #{ xs }
                                        @(posedge #{ tag }_io_test_ready);
                                    |]</span></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>                            </span><span id="local-6989586621680038197"><span class="annot"><span class="annottext">sendingAssert :: HashMap v x -&gt; Doc Any
</span><a href="#local-6989586621680038197"><span class="hs-identifier hs-var hs-var">sendingAssert</span></a></span></span><span> </span><span id="local-6989586621680038196"><span class="annot"><span class="annottext">HashMap v x
</span><a href="#local-6989586621680038196"><span class="hs-identifier hs-var">transmit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-346"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680038195"><span class="annot"><span class="annottext">xs :: [x]
</span><a href="#local-6989586621680038195"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(v -&gt; x) -&gt; [v] -&gt; [x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680038194"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680038194"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; Maybe x -&gt; x
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">x
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">(Maybe x -&gt; x) -&gt; Maybe x -&gt; x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; HashMap v x -&gt; Maybe x
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680038194"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap v x
</span><a href="#local-6989586621680038196"><span class="hs-identifier hs-var">transmit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680038254"><span class="hs-identifier hs-var">sendedVariableSeq</span></a></span><span>
</span><span id="line-347"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[__i|
                                        @(posedge #{ tag }_io_test_ready);
                                            $display( &quot;#{ tag }_io_test_output except: %H ({ #{ toVerilogLiteral xs } })&quot;, { #{ toVerilogLiteral xs } } );
                                            $display( &quot;#{ tag }_io_test_output actual: %H&quot;, #{ tag }_io_test_output );
                                            if ( #{ tag }_io_test_output !=  { #{ toVerilogLiteral xs } } )
                                                $display(&quot;                       FAIL&quot;);
                                            $display();
                                    |]</span></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>                            </span><span id="local-6989586621680038193"><span class="annot"><span class="annottext">envInstance :: Verilog
</span><a href="#local-6989586621680038193"><span class="hs-identifier hs-var hs-var">envInstance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-357"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    /*
                                    #{ pretty sio }
                                    */
                                    reg #{ tag }_io_test_start_transaction;
                                    reg  [#{ frameWidth }-1:0] #{ tag }_io_test_input;
                                    wire #{ tag }_io_test_ready;
                                    wire [#{ frameWidth }-1:0] #{ tag }_io_test_output;
                                    initial #{ envInitFlagName } &lt;= 0; // should be defined on the testbench level.
                                    spi_slave_driver \#
                                            ( .DATA_WIDTH( #{ frameWidth } )
                                            ) #{ tag }_io_test_slave
                                        ( .clk( #{ sigClk } )
                                        , .rst( #{ sigRst } )
                                        , .data_in( #{ tag }_io_test_input )
                                        , .data_out( #{ tag }_io_test_output )
                                        , .ready( #{ tag }_io_test_ready )
                                        , .mosi( #{ master_mosi } )
                                        , .miso( #{ master_miso } )
                                        , .sclk( #{ master_sclk } )
                                        , .cs( #{ master_cs } )
                                        );
                                |]</span></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span>                            </span><span id="local-6989586621680038192"><span class="annot"><span class="annottext">interactions :: Verilog
</span><a href="#local-6989586621680038192"><span class="hs-identifier hs-var hs-var">interactions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-382"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    // SPI Input signal generation
                                    initial begin
                                        @(negedge #{ sigRst });
                                        #{ nest 4 $ receiveCycle $ head receivedVarsValues }
                                        #{ envInitFlagName } &lt;= 1;

                                        #{ nest 4 $ vsep $ map receiveCycle $ tail receivedVarsValues }
                                        repeat(70) @(posedge #{ sigClk });
                                        // $finish; // DON'T DO THAT (with this line test can pass without data checking)
                                    end

                                    // SPI Output signal checking
                                    initial begin
                                        @(negedge #{ sigRst });
                                        repeat(2) @(posedge #{ tag }_io_test_ready);
                                        #{ nest 4 $ vsep $ map sendingAssert sendedVarsValues }
                                    end
                                |]</span></span><span>
</span><span id="line-401"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Verilog -&gt; Maybe Verilog
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Verilog
</span><a href="#local-6989586621680038193"><span class="hs-identifier hs-var">envInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Verilog -&gt; Verilog -&gt; Verilog
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Verilog
forall ann. Doc ann
</span><span class="hs-identifier hs-var">line</span></span><span> </span><span class="annot"><span class="annottext">Verilog -&gt; Verilog -&gt; Verilog
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Verilog
forall ann. Doc ann
</span><span class="hs-identifier hs-var">line</span></span><span> </span><span class="annot"><span class="annottext">Verilog -&gt; Verilog -&gt; Verilog
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680038247"><span class="hs-identifier hs-var">frameWordCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Verilog
</span><a href="#local-6989586621680038227"><span class="hs-identifier hs-var">disable</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Verilog
</span><a href="#local-6989586621680038192"><span class="hs-identifier hs-var">interactions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><a href="NITTA.Project.TestBench.html#testEnvironment"><span class="hs-identifier hs-var">testEnvironment</span></a></span><span> </span><span id="local-6989586621680038188"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680038188"><span class="hs-identifier hs-var">_title</span></a></span></span><span> </span><span id="local-6989586621680038187"><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680038187"><span class="hs-identifier hs-var">_pu</span></a></span></span><span> </span><span id="local-6989586621680038186"><span class="annot"><span class="annottext">UnitEnv (SPI v x t)
</span><a href="#local-6989586621680038186"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span id="local-6989586621680038185"><span class="annot"><span class="annottext">TestEnvironment v x
</span><a href="#local-6989586621680038185"><span class="hs-identifier hs-var">_tEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe Verilog
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;internal error&quot;</span></span></span></span></span><span>
</span><span id="line-403"></span></pre></body></html>