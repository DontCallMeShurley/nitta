<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">{- |
Module      : NITTA.Utils.ProcessDescription
Description : Utilities for process description.
Copyright   : (c) Aleksandr Penskoi, 2019
License     : BSD3
Maintainer  : aleksandr.penskoi@gmail.com
Stability   : experimental

A multilevel process is an object with a complex internal structure. Process description should
contain every step (including start and finish time), and relations between them (Vertical or
sequence). It is possible to define process manually, but, in practice, is preferred to use 'State'
based builder from that module.

It also agreed to the process inspection.
-}</span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NITTA.Utils.ProcessDescription</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#runSchedule"><span class="hs-identifier">runSchedule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#execSchedule"><span class="hs-identifier">execSchedule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#execScheduleWithProcess"><span class="hs-identifier">execScheduleWithProcess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleEndpoint"><span class="hs-identifier">scheduleEndpoint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleEndpoint_"><span class="hs-identifier">scheduleEndpoint_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleFunctionBind"><span class="hs-identifier">scheduleFunctionBind</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleFunctionRevoke"><span class="hs-identifier">scheduleFunctionRevoke</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleFunction"><span class="hs-identifier">scheduleFunction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleRefactoring"><span class="hs-identifier">scheduleRefactoring</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleInstructionUnsafe"><span class="hs-identifier">scheduleInstructionUnsafe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleInstructionUnsafe_"><span class="hs-identifier">scheduleInstructionUnsafe_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleNestedStep"><span class="hs-identifier">scheduleNestedStep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#establishVerticalRelations"><span class="hs-identifier">establishVerticalRelations</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#establishVerticalRelation"><span class="hs-identifier">establishVerticalRelation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#getProcessSlice"><span class="hs-identifier">getProcessSlice</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#castInstruction"><span class="hs-identifier">castInstruction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">asProxyTypeOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.html"><span class="hs-identifier">NITTA.Model.Problems</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html"><span class="hs-identifier">NITTA.Model.ProcessorUnits.Types</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.Interval.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">singleton</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sup</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">-- |Process builder state.</span><span>
</span><span id="line-48"></span><span class="hs-keyword">data</span><span> </span><span id="Schedule"><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-var">Schedule</span></a></span></span><span> </span><span id="local-6989586621680035978"><span class="annot"><a href="#local-6989586621680035978"><span class="hs-identifier hs-type">pu</span></a></span></span><span> </span><span id="local-6989586621680035977"><span class="annot"><a href="#local-6989586621680035977"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680035976"><span class="annot"><a href="#local-6989586621680035976"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680035975"><span class="annot"><a href="#local-6989586621680035975"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Schedule"><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-var">Schedule</span></a></span></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- |Defining process.</span><span>
</span><span id="line-50"></span><span>      </span><span id="schProcess"><span class="annot"><span class="annottext">Schedule pu v x t -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var hs-var">schProcess</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Process"><span class="hs-identifier hs-type">Process</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035975"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#StepInfo"><span class="hs-identifier hs-type">StepInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035977"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035976"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035975"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- |Proxy for process unit instruction, which is needed for API simplify. Without that,</span><span>
</span><span id="line-52"></span><span>      </span><span class="hs-comment">-- for some function, the user needs to describe type explicitly.</span><span>
</span><span id="line-53"></span><span>      </span><span id="iProxy"><span class="annot"><span class="annottext">Schedule pu v x t -&gt; Proxy (Instruction pu)
</span><a href="NITTA.Utils.ProcessDescription.html#iProxy"><span class="hs-identifier hs-var hs-var">iProxy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035978"><span class="hs-identifier hs-type">pu</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span id="local-6989586621680035774"><span id="local-6989586621680035775"><span id="local-6989586621680035776"><span id="local-6989586621680035777"><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPS</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#NextTick"><span class="hs-identifier hs-type">NextTick</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-type">Schedule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035777"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035776"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035775"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035774"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680035774"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-57"></span><span>    </span><span id="local-6989586621680035771"><span class="annot"><span class="annottext">nextTick :: Schedule pu v x t -&gt; t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-var hs-var hs-var hs-var">nextTick</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t) -&gt; t
forall u t. NextTick u t =&gt; u -&gt; t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-var">nextTick</span></a></span><span> </span><span class="annot"><span class="annottext">(Process t (StepInfo v x t) -&gt; t)
-&gt; (Schedule pu v x t -&gt; Process t (StepInfo v x t))
-&gt; Schedule pu v x t
-&gt; t
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Schedule pu v x t -&gt; Process t (StepInfo v x t)
forall pu v x t. Schedule pu v x t -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var hs-var">schProcess</span></a></span></span></span></span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">{- |Execute process builder and return new process description. The initial process state is getting
from the PU by the 'process' function.
-}</span><span>
</span><span id="line-62"></span><span id="execSchedule"><span class="annot"><span class="annottext">execSchedule :: u
-&gt; StateT (Schedule u v x t) Identity a
-&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#execSchedule"><span class="hs-identifier hs-var hs-var">execSchedule</span></a></span></span><span> </span><span id="local-6989586621680035768"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680035768"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span id="local-6989586621680035767"><span class="annot"><span class="annottext">StateT (Schedule u v x t) Identity a
</span><a href="#local-6989586621680035767"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, Process t (StepInfo v x t)) -&gt; Process t (StepInfo v x t)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((a, Process t (StepInfo v x t)) -&gt; Process t (StepInfo v x t))
-&gt; (a, Process t (StepInfo v x t)) -&gt; Process t (StepInfo v x t)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">u
-&gt; StateT (Schedule u v x t) Identity a
-&gt; (a, Process t (StepInfo v x t))
forall u v x t a.
ProcessorUnit u v x t =&gt;
u
-&gt; StateT (Schedule u v x t) Identity a
-&gt; (a, Process t (StepInfo v x t))
</span><a href="NITTA.Utils.ProcessDescription.html#runSchedule"><span class="hs-identifier hs-var">runSchedule</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680035768"><span class="hs-identifier hs-var">pu</span></a></span><span> </span><span class="annot"><span class="annottext">StateT (Schedule u v x t) Identity a
</span><a href="#local-6989586621680035767"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">{- |Execute process builder and return new process description. The initial
process state is passed explicetly.

Why can not we get a process here? In the case of Bus Network, it also fetches
processes from underlying units.
-}</span><span>
</span><span id="line-70"></span><span id="execScheduleWithProcess"><span class="annot"><span class="annottext">execScheduleWithProcess :: pu
-&gt; Process t (StepInfo v x t)
-&gt; StateT (Schedule pu v x t) Identity a
-&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#execScheduleWithProcess"><span class="hs-identifier hs-var hs-var">execScheduleWithProcess</span></a></span></span><span> </span><span id="local-6989586621680035766"><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680035766"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span id="local-6989586621680035765"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680035765"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680035764"><span class="annot"><span class="annottext">StateT (Schedule pu v x t) Identity a
</span><a href="#local-6989586621680035764"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, Process t (StepInfo v x t)) -&gt; Process t (StepInfo v x t)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((a, Process t (StepInfo v x t)) -&gt; Process t (StepInfo v x t))
-&gt; (a, Process t (StepInfo v x t)) -&gt; Process t (StepInfo v x t)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">pu
-&gt; Process t (StepInfo v x t)
-&gt; StateT (Schedule pu v x t) Identity a
-&gt; (a, Process t (StepInfo v x t))
forall pu t v x a.
pu
-&gt; Process t (StepInfo v x t)
-&gt; StateT (Schedule pu v x t) Identity a
-&gt; (a, Process t (StepInfo v x t))
</span><a href="NITTA.Utils.ProcessDescription.html#runScheduleWithProcess"><span class="hs-identifier hs-var">runScheduleWithProcess</span></a></span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680035766"><span class="hs-identifier hs-var">pu</span></a></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680035765"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">StateT (Schedule pu v x t) Identity a
</span><a href="#local-6989586621680035764"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">{- |Execute process builder and return list of new step UID and new process description. The initial
process state is getting from the PU by the 'process' function.
-}</span><span>
</span><span id="line-75"></span><span id="runSchedule"><span class="annot"><span class="annottext">runSchedule :: u
-&gt; StateT (Schedule u v x t) Identity a
-&gt; (a, Process t (StepInfo v x t))
</span><a href="NITTA.Utils.ProcessDescription.html#runSchedule"><span class="hs-identifier hs-var hs-var">runSchedule</span></a></span></span><span> </span><span id="local-6989586621680035762"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680035762"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span id="local-6989586621680035761"><span class="annot"><span class="annottext">StateT (Schedule u v x t) Identity a
</span><a href="#local-6989586621680035761"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">u
-&gt; Process t (StepInfo v x t)
-&gt; StateT (Schedule u v x t) Identity a
-&gt; (a, Process t (StepInfo v x t))
forall pu t v x a.
pu
-&gt; Process t (StepInfo v x t)
-&gt; StateT (Schedule pu v x t) Identity a
-&gt; (a, Process t (StepInfo v x t))
</span><a href="NITTA.Utils.ProcessDescription.html#runScheduleWithProcess"><span class="hs-identifier hs-var">runScheduleWithProcess</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680035762"><span class="hs-identifier hs-var">pu</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">u -&gt; Process t (StepInfo v x t)
forall u v x t.
ProcessorUnit u v x t =&gt;
u -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Model.ProcessorUnits.Types.html#process"><span class="hs-identifier hs-var">process</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680035762"><span class="hs-identifier hs-var">pu</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StateT (Schedule u v x t) Identity a
</span><a href="#local-6989586621680035761"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">{- |Execute process builder and return list of new step UID and new process description. The initial
process state is passed explicetly.
-}</span><span>
</span><span id="line-80"></span><span id="runScheduleWithProcess"><span class="annot"><span class="annottext">runScheduleWithProcess :: pu
-&gt; Process t (StepInfo v x t)
-&gt; StateT (Schedule pu v x t) Identity a
-&gt; (a, Process t (StepInfo v x t))
</span><a href="NITTA.Utils.ProcessDescription.html#runScheduleWithProcess"><span class="hs-identifier hs-var hs-var">runScheduleWithProcess</span></a></span></span><span> </span><span id="local-6989586621680035759"><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680035759"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span id="local-6989586621680035758"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680035758"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680035757"><span class="annot"><span class="annottext">StateT (Schedule pu v x t) Identity a
</span><a href="#local-6989586621680035757"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680035756"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680035756"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035755"><span class="annot"><span class="annottext">Schedule pu v x t
</span><a href="#local-6989586621680035755"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>            </span><span class="annot"><span class="annottext">StateT (Schedule pu v x t) Identity a
-&gt; Schedule pu v x t -&gt; (a, Schedule pu v x t)
forall s a. State s a -&gt; s -&gt; (a, s)
</span><span class="hs-identifier hs-var">runState</span></span><span>
</span><span id="line-83"></span><span>                </span><span class="annot"><span class="annottext">StateT (Schedule pu v x t) Identity a
</span><a href="#local-6989586621680035757"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-84"></span><span>                </span><span class="annot"><span class="annottext">Schedule :: forall pu v x t.
Process t (StepInfo v x t)
-&gt; Proxy (Instruction pu) -&gt; Schedule pu v x t
</span><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-type">Schedule</span></a></span><span>
</span><span id="line-85"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">schProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var">schProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680035758"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-86"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iProxy :: Proxy (Instruction pu)
</span><a href="NITTA.Utils.ProcessDescription.html#iProxy"><span class="hs-identifier hs-var">iProxy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">pu -&gt; Proxy (Instruction pu)
forall pu. pu -&gt; Proxy (Instruction pu)
</span><a href="#local-6989586621680035753"><span class="hs-identifier hs-var">ip</span></a></span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680035759"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-87"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-88"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680035756"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Schedule pu v x t -&gt; Process t (StepInfo v x t)
forall pu v x t. Schedule pu v x t -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var hs-var">schProcess</span></a></span><span> </span><span class="annot"><span class="annottext">Schedule pu v x t
</span><a href="#local-6989586621680035755"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>        </span><span id="local-6989586621680035939"><span class="annot"><a href="#local-6989586621680035753"><span class="hs-identifier hs-type">ip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680035939"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035939"><span class="hs-identifier hs-type">pu</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-91"></span><span>        </span><span id="local-6989586621680035753"><span class="annot"><span class="annottext">ip :: pu -&gt; Proxy (Instruction pu)
</span><a href="#local-6989586621680035753"><span class="hs-identifier hs-var hs-var">ip</span></a></span></span><span> </span><span class="annot"><span class="annottext">pu
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy (Instruction pu)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- |Add process step with passed the time and info.</span><span>
</span><span id="line-94"></span><span id="scheduleStep"><span class="annot"><span class="annottext">scheduleStep :: Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleStep"><span class="hs-identifier hs-var hs-var">scheduleStep</span></a></span></span><span> </span><span id="local-6989586621680035750"><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035750"><span class="hs-identifier hs-var">placeInTime</span></a></span></span><span> </span><span id="local-6989586621680035749"><span class="annot"><span class="annottext">StepInfo v x t
</span><a href="#local-6989586621680035749"><span class="hs-identifier hs-var">stepInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="annottext">(ProcessStepID -&gt; Step t (StepInfo v x t)) -&gt; m [ProcessStepID]
forall (m :: * -&gt; *) pu v x t.
MonadState (Schedule pu v x t) m =&gt;
(ProcessStepID -&gt; Step t (StepInfo v x t)) -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleStep%27"><span class="hs-identifier hs-var">scheduleStep'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680035747"><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035747"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProcessStepID
-&gt; Interval t -&gt; StepInfo v x t -&gt; Step t (StepInfo v x t)
forall t i. ProcessStepID -&gt; Interval t -&gt; i -&gt; Step t i
</span><a href="NITTA.Model.ProcessorUnits.Types.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035747"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035750"><span class="hs-identifier hs-var">placeInTime</span></a></span><span> </span><span class="annot"><span class="annottext">StepInfo v x t
</span><a href="#local-6989586621680035749"><span class="hs-identifier hs-var">stepInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span id="scheduleStep%27"><span class="annot"><span class="annottext">scheduleStep' :: (ProcessStepID -&gt; Step t (StepInfo v x t)) -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleStep%27"><span class="hs-identifier hs-var hs-var">scheduleStep'</span></a></span></span><span> </span><span id="local-6989586621680035745"><span class="annot"><span class="annottext">ProcessStepID -&gt; Step t (StepInfo v x t)
</span><a href="#local-6989586621680035745"><span class="hs-identifier hs-var">mkStep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621680035744"><span class="annot"><span class="annottext">sch :: Schedule pu v x t
</span><a href="#local-6989586621680035744"><span class="hs-identifier hs-var">sch</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-type">Schedule</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">schProcess :: forall pu v x t. Schedule pu v x t -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var">schProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680035743"><span class="annot"><span class="annottext">p :: Process t (StepInfo v x t)
</span><a href="#local-6989586621680035743"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Process"><span class="hs-identifier hs-type">Process</span></a></span><span class="hs-special">{</span><span id="local-6989586621680035741"><span class="annot"><span class="annottext">ProcessStepID
nextUid :: forall t i. Process t i -&gt; ProcessStepID
nextUid :: ProcessStepID
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextUid"><span class="hs-identifier hs-var hs-var">nextUid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035739"><span class="annot"><span class="annottext">[Step t (StepInfo v x t)]
steps :: forall t i. Process t i -&gt; [Step t i]
steps :: [Step t (StepInfo v x t)]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#steps"><span class="hs-identifier hs-var hs-var">steps</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Schedule pu v x t)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">Schedule pu v x t -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="annottext">Schedule pu v x t
</span><a href="#local-6989586621680035744"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-101"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">schProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var">schProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>                </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680035743"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-103"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nextUid :: ProcessStepID
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextUid"><span class="hs-identifier hs-var">nextUid</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProcessStepID -&gt; ProcessStepID
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035741"><span class="hs-identifier hs-var">nextUid</span></a></span><span>
</span><span id="line-104"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">steps :: [Step t (StepInfo v x t)]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#steps"><span class="hs-identifier hs-var">steps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProcessStepID -&gt; Step t (StepInfo v x t)
</span><a href="#local-6989586621680035745"><span class="hs-identifier hs-var">mkStep</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035741"><span class="hs-identifier hs-var">nextUid</span></a></span><span> </span><span class="annot"><span class="annottext">Step t (StepInfo v x t)
-&gt; [Step t (StepInfo v x t)] -&gt; [Step t (StepInfo v x t)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Step t (StepInfo v x t)]
</span><a href="#local-6989586621680035739"><span class="hs-identifier hs-var">steps</span></a></span><span>
</span><span id="line-105"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-106"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="annottext">[ProcessStepID] -&gt; m [ProcessStepID]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035741"><span class="hs-identifier hs-var">nextUid</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">{- |Add to the process description information about vertical relations, which are defined by the
 Cartesian product of high and low lists.
-}</span><span>
</span><span id="line-112"></span><span id="establishVerticalRelations"><span class="annot"><span class="annottext">establishVerticalRelations :: [ProcessStepID] -&gt; [ProcessStepID] -&gt; m ()
</span><a href="NITTA.Utils.ProcessDescription.html#establishVerticalRelations"><span class="hs-identifier hs-var hs-var">establishVerticalRelations</span></a></span></span><span> </span><span id="local-6989586621680035734"><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035734"><span class="hs-identifier hs-var">high</span></a></span></span><span> </span><span id="local-6989586621680035733"><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035733"><span class="hs-identifier hs-var">low</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>    </span><span id="local-6989586621680035732"><span class="annot"><span class="annottext">sch :: Schedule pu v x t
</span><a href="#local-6989586621680035732"><span class="hs-identifier hs-var">sch</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-type">Schedule</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">schProcess :: forall pu v x t. Schedule pu v x t -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var">schProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680035731"><span class="annot"><span class="annottext">p :: Process t (StepInfo v x t)
</span><a href="#local-6989586621680035731"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Process"><span class="hs-identifier hs-type">Process</span></a></span><span class="hs-special">{</span><span id="local-6989586621680035730"><span class="annot"><span class="annottext">[Relation]
relations :: forall t i. Process t i -&gt; [Relation]
relations :: [Relation]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#relations"><span class="hs-identifier hs-var hs-var">relations</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Schedule pu v x t)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><span class="annottext">Schedule pu v x t -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">Schedule pu v x t
</span><a href="#local-6989586621680035732"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-116"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">schProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var">schProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>                </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680035731"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-118"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">relations :: [Relation]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#relations"><span class="hs-identifier hs-var">relations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ProcessStepID -&gt; ProcessStepID -&gt; Relation
</span><a href="NITTA.Model.ProcessorUnits.Types.html#Vertical"><span class="hs-identifier hs-var">Vertical</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035727"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035726"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680035727"><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035727"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035734"><span class="hs-identifier hs-var">high</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035726"><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035726"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035733"><span class="hs-identifier hs-var">low</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Relation] -&gt; [Relation] -&gt; [Relation]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Relation]
</span><a href="#local-6989586621680035730"><span class="hs-identifier hs-var">relations</span></a></span><span>
</span><span id="line-119"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-120"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- |Add to the process description information about vertical relation.</span><span>
</span><span id="line-123"></span><span id="establishVerticalRelation"><span class="annot"><span class="annottext">establishVerticalRelation :: ProcessStepID -&gt; ProcessStepID -&gt; m ()
</span><a href="NITTA.Utils.ProcessDescription.html#establishVerticalRelation"><span class="hs-identifier hs-var hs-var">establishVerticalRelation</span></a></span></span><span> </span><span id="local-6989586621680035725"><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035725"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621680035724"><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035724"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621680035723"><span class="annot"><span class="annottext">sch :: Schedule pu v x t
</span><a href="#local-6989586621680035723"><span class="hs-identifier hs-var">sch</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-type">Schedule</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">schProcess :: forall pu v x t. Schedule pu v x t -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var">schProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680035722"><span class="annot"><span class="annottext">p :: Process t (StepInfo v x t)
</span><a href="#local-6989586621680035722"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Process"><span class="hs-identifier hs-type">Process</span></a></span><span class="hs-special">{</span><span id="local-6989586621680035721"><span class="annot"><span class="annottext">[Relation]
relations :: [Relation]
relations :: forall t i. Process t i -&gt; [Relation]
</span><a href="#local-6989586621680035721"><span class="hs-identifier hs-var hs-var">relations</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Schedule pu v x t)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">Schedule pu v x t -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><span class="annottext">Schedule pu v x t
</span><a href="#local-6989586621680035723"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-127"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">schProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var">schProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>                </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680035722"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-129"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">relations :: [Relation]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#relations"><span class="hs-identifier hs-var">relations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProcessStepID -&gt; ProcessStepID -&gt; Relation
</span><a href="NITTA.Model.ProcessorUnits.Types.html#Vertical"><span class="hs-identifier hs-var">Vertical</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035725"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035724"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Relation -&gt; [Relation] -&gt; [Relation]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Relation]
</span><a href="#local-6989586621680035721"><span class="hs-identifier hs-var">relations</span></a></span><span>
</span><span id="line-130"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span id="scheduleFunctionBind"><span class="annot"><span class="annottext">scheduleFunctionBind :: a -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleFunctionBind"><span class="hs-identifier hs-var hs-var">scheduleFunctionBind</span></a></span></span><span> </span><span id="local-6989586621680035720"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680035720"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621680035719"><span class="annot"><span class="annottext">Schedule pu v x t
</span><a href="#local-6989586621680035719"><span class="hs-identifier hs-var">schedule</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Schedule pu v x t)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall pu v x t (m :: * -&gt; *).
MonadState (Schedule pu v x t) m =&gt;
Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleStep"><span class="hs-identifier hs-var">scheduleStep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Interval t
forall a. a -&gt; Interval a
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="annottext">(t -&gt; Interval t) -&gt; t -&gt; Interval t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Schedule pu v x t -&gt; t
forall u t. NextTick u t =&gt; u -&gt; t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-var">nextTick</span></a></span><span> </span><span class="annot"><span class="annottext">Schedule pu v x t
</span><a href="#local-6989586621680035719"><span class="hs-identifier hs-var">schedule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StepInfo v x t -&gt; m [ProcessStepID])
-&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; StepInfo v x t
forall v x t. String -&gt; StepInfo v x t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#CADStep"><span class="hs-identifier hs-var">CADStep</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; StepInfo v x t) -&gt; String -&gt; StepInfo v x t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bind &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680035720"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span id="scheduleFunctionRevoke"><span class="annot"><span class="annottext">scheduleFunctionRevoke :: a -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleFunctionRevoke"><span class="hs-identifier hs-var hs-var">scheduleFunctionRevoke</span></a></span></span><span> </span><span id="local-6989586621680035716"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680035716"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621680035715"><span class="annot"><span class="annottext">Schedule pu v x t
</span><a href="#local-6989586621680035715"><span class="hs-identifier hs-var">schedule</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Schedule pu v x t)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall pu v x t (m :: * -&gt; *).
MonadState (Schedule pu v x t) m =&gt;
Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleStep"><span class="hs-identifier hs-var">scheduleStep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Interval t
forall a. a -&gt; Interval a
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="annottext">(t -&gt; Interval t) -&gt; t -&gt; Interval t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Schedule pu v x t -&gt; t
forall u t. NextTick u t =&gt; u -&gt; t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-var">nextTick</span></a></span><span> </span><span class="annot"><span class="annottext">Schedule pu v x t
</span><a href="#local-6989586621680035715"><span class="hs-identifier hs-var">schedule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StepInfo v x t -&gt; m [ProcessStepID])
-&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; StepInfo v x t
forall v x t. String -&gt; StepInfo v x t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#CADStep"><span class="hs-identifier hs-var">CADStep</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; StepInfo v x t) -&gt; String -&gt; StepInfo v x t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;revoke &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680035716"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- |Add to the process description information about function evaluation.</span><span>
</span><span id="line-142"></span><span id="scheduleFunction"><span class="annot"><span class="annottext">scheduleFunction :: Interval t -&gt; F v x -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleFunction"><span class="hs-identifier hs-var hs-var">scheduleFunction</span></a></span></span><span> </span><span id="local-6989586621680035714"><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035714"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621680035713"><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680035713"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall pu v x t (m :: * -&gt; *).
MonadState (Schedule pu v x t) m =&gt;
Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleStep"><span class="hs-identifier hs-var">scheduleStep</span></a></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035714"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(StepInfo v x t -&gt; m [ProcessStepID])
-&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; StepInfo v x t
forall v x t. F v x -&gt; StepInfo v x t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#FStep"><span class="hs-identifier hs-var">FStep</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680035713"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span id="scheduleRefactoring"><span class="annot"><span class="annottext">scheduleRefactoring :: Interval t -&gt; ref -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleRefactoring"><span class="hs-identifier hs-var hs-var">scheduleRefactoring</span></a></span></span><span> </span><span id="local-6989586621680035711"><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035711"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621680035710"><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621680035710"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall pu v x t (m :: * -&gt; *).
MonadState (Schedule pu v x t) m =&gt;
Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleStep"><span class="hs-identifier hs-var">scheduleStep</span></a></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035711"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">(StepInfo v x t -&gt; m [ProcessStepID])
-&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ref -&gt; StepInfo v x t
forall ref v x t.
(Typeable ref, Show ref, Eq ref) =&gt;
ref -&gt; StepInfo v x t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#RefactorStep"><span class="hs-identifier hs-var">RefactorStep</span></a></span><span> </span><span class="annot"><span class="annottext">ref
</span><a href="#local-6989586621680035710"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">{- |Add to the process description information about endpoint behaviour, and it's low-level
implementation (on instruction level). Vertical relations connect endpoint level and instruction
level steps.
-}</span><span>
</span><span id="line-150"></span><span id="scheduleEndpoint"><span class="annot"><span class="annottext">scheduleEndpoint :: EndpointSt v (Interval t) -&gt; m [ProcessStepID] -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleEndpoint"><span class="hs-identifier hs-var hs-var">scheduleEndpoint</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Endpoint.html#EndpointSt"><span class="hs-identifier hs-type">EndpointSt</span></a></span><span class="hs-special">{</span><span id="local-6989586621680035707"><span class="annot"><span class="annottext">Interval t
epAt :: forall v tp. EndpointSt v tp -&gt; tp
epAt :: Interval t
</span><a href="NITTA.Model.Problems.Endpoint.html#epAt"><span class="hs-identifier hs-var hs-var">epAt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035705"><span class="annot"><span class="annottext">EndpointRole v
epRole :: forall v tp. EndpointSt v tp -&gt; EndpointRole v
epRole :: EndpointRole v
</span><a href="NITTA.Model.Problems.Endpoint.html#epRole"><span class="hs-identifier hs-var hs-var">epRole</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680035703"><span class="annot"><span class="annottext">m [ProcessStepID]
</span><a href="#local-6989586621680035703"><span class="hs-identifier hs-var">codeGen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621680035702"><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035702"><span class="hs-identifier hs-var">high</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall pu v x t (m :: * -&gt; *).
MonadState (Schedule pu v x t) m =&gt;
Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleStep"><span class="hs-identifier hs-var">scheduleStep</span></a></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035707"><span class="hs-identifier hs-var">epAt</span></a></span><span> </span><span class="annot"><span class="annottext">(StepInfo v x t -&gt; m [ProcessStepID])
-&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EndpointRole v -&gt; StepInfo v x t
forall v x t. EndpointRole v -&gt; StepInfo v x t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#EndpointRoleStep"><span class="hs-identifier hs-var">EndpointRoleStep</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointRole v
</span><a href="#local-6989586621680035705"><span class="hs-identifier hs-var">epRole</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621680035700"><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035700"><span class="hs-identifier hs-var">low</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [ProcessStepID]
</span><a href="#local-6989586621680035703"><span class="hs-identifier hs-var">codeGen</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="annottext">[ProcessStepID] -&gt; [ProcessStepID] -&gt; m ()
forall (m :: * -&gt; *) pu v x t.
MonadState (Schedule pu v x t) m =&gt;
[ProcessStepID] -&gt; [ProcessStepID] -&gt; m ()
</span><a href="NITTA.Utils.ProcessDescription.html#establishVerticalRelations"><span class="hs-identifier hs-var">establishVerticalRelations</span></a></span><span> </span><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035702"><span class="hs-identifier hs-var">high</span></a></span><span> </span><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035700"><span class="hs-identifier hs-var">low</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="annottext">[ProcessStepID] -&gt; m [ProcessStepID]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035702"><span class="hs-identifier hs-var">high</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span id="scheduleEndpoint_"><span class="annot"><span class="annottext">scheduleEndpoint_ :: EndpointSt v (Interval t) -&gt; f [ProcessStepID] -&gt; f ()
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleEndpoint_"><span class="hs-identifier hs-var hs-var">scheduleEndpoint_</span></a></span></span><span> </span><span id="local-6989586621680035699"><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680035699"><span class="hs-identifier hs-var">ep</span></a></span></span><span> </span><span id="local-6989586621680035698"><span class="annot"><span class="annottext">f [ProcessStepID]
</span><a href="#local-6989586621680035698"><span class="hs-identifier hs-var">codeGen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f [ProcessStepID] -&gt; f ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(f [ProcessStepID] -&gt; f ()) -&gt; f [ProcessStepID] -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t) -&gt; f [ProcessStepID] -&gt; f [ProcessStepID]
forall (m :: * -&gt; *) pu v x t.
MonadState (Schedule pu v x t) m =&gt;
EndpointSt v (Interval t) -&gt; m [ProcessStepID] -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleEndpoint"><span class="hs-identifier hs-var">scheduleEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680035699"><span class="hs-identifier hs-var">ep</span></a></span><span> </span><span class="annot"><span class="annottext">f [ProcessStepID]
</span><a href="#local-6989586621680035698"><span class="hs-identifier hs-var">codeGen</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-comment">{- |Add to the process description information about instruction evaluation.
Unsafe means: without instruction collision check and nextTick consistency.
-}</span><span>
</span><span id="line-161"></span><span id="scheduleInstructionUnsafe"><span class="annot"><span class="annottext">scheduleInstructionUnsafe :: Interval t -&gt; Instruction pu -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleInstructionUnsafe"><span class="hs-identifier hs-var hs-var">scheduleInstructionUnsafe</span></a></span></span><span> </span><span id="local-6989586621680035696"><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035696"><span class="hs-identifier hs-var">at</span></a></span></span><span> </span><span id="local-6989586621680035695"><span class="annot"><span class="annottext">Instruction pu
</span><a href="#local-6989586621680035695"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-type">Schedule</span></a></span><span class="hs-special">{</span><span id="local-6989586621680035694"><span class="annot"><span class="annottext">Proxy (Instruction pu)
iProxy :: Proxy (Instruction pu)
iProxy :: forall pu v x t. Schedule pu v x t -&gt; Proxy (Instruction pu)
</span><a href="#local-6989586621680035694"><span class="hs-identifier hs-var hs-var">iProxy</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Schedule pu v x t)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621680035693"><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035693"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall pu v x t (m :: * -&gt; *).
MonadState (Schedule pu v x t) m =&gt;
Interval t -&gt; StepInfo v x t -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleStep"><span class="hs-identifier hs-var">scheduleStep</span></a></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035696"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">(StepInfo v x t -&gt; m [ProcessStepID])
-&gt; StepInfo v x t -&gt; m [ProcessStepID]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Instruction pu -&gt; StepInfo v x t
forall pu v x t.
(Show (Instruction pu), Typeable (Instruction pu)) =&gt;
Instruction pu -&gt; StepInfo v x t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#InstructionStep"><span class="hs-identifier hs-var">InstructionStep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Instruction pu
</span><a href="#local-6989586621680035695"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="annot"><span class="annottext">Instruction pu -&gt; Proxy (Instruction pu) -&gt; Instruction pu
forall a (proxy :: * -&gt; *). a -&gt; proxy a -&gt; a
</span><span class="hs-operator hs-var">`asProxyTypeOf`</span></span><span> </span><span class="annot"><span class="annottext">Proxy (Instruction pu)
</span><a href="#local-6989586621680035694"><span class="hs-identifier hs-var">iProxy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">t -&gt; m ()
forall (m :: * -&gt; *) pu v x t.
MonadState (Schedule pu v x t) m =&gt;
t -&gt; m ()
</span><a href="#local-6989586621680035691"><span class="hs-identifier hs-var">updateTick</span></a></span><span> </span><span class="annot"><span class="annottext">(t -&gt; m ()) -&gt; t -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; t
forall a. Interval a -&gt; a
</span><span class="hs-identifier hs-var">sup</span></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035696"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">[ProcessStepID] -&gt; m [ProcessStepID]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035693"><span class="hs-identifier hs-var">buf</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>        </span><span id="local-6989586621680035691"><span class="annot"><span class="annottext">updateTick :: t -&gt; m ()
</span><a href="#local-6989586621680035691"><span class="hs-identifier hs-var hs-var">updateTick</span></a></span></span><span> </span><span id="local-6989586621680035689"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680035689"><span class="hs-identifier hs-var">tick</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>            </span><span id="local-6989586621680035688"><span class="annot"><span class="annottext">sch :: Schedule pu v x t
</span><a href="#local-6989586621680035688"><span class="hs-identifier hs-var">sch</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-type">Schedule</span></a></span><span class="hs-special">{</span><span id="local-6989586621680035687"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
schProcess :: Process t (StepInfo v x t)
schProcess :: forall pu v x t. Schedule pu v x t -&gt; Process t (StepInfo v x t)
</span><a href="#local-6989586621680035687"><span class="hs-identifier hs-var hs-var">schProcess</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Schedule pu v x t)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-169"></span><span>            </span><span class="annot"><span class="annottext">Schedule pu v x t -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span>
</span><span id="line-170"></span><span>                </span><span class="annot"><span class="annottext">Schedule pu v x t
</span><a href="#local-6989586621680035688"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-171"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">schProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#schProcess"><span class="hs-identifier hs-var">schProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-172"></span><span>                        </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680035687"><span class="hs-identifier hs-var">schProcess</span></a></span><span>
</span><span id="line-173"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nextTick_ :: t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick_"><span class="hs-identifier hs-var">nextTick_</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680035689"><span class="hs-identifier hs-var">tick</span></a></span><span>
</span><span id="line-174"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-175"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span id="scheduleInstructionUnsafe_"><span class="annot"><span class="annottext">scheduleInstructionUnsafe_ :: Interval t -&gt; Instruction pu -&gt; f ()
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleInstructionUnsafe_"><span class="hs-identifier hs-var hs-var">scheduleInstructionUnsafe_</span></a></span></span><span> </span><span id="local-6989586621680035685"><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035685"><span class="hs-identifier hs-var">ti</span></a></span></span><span> </span><span id="local-6989586621680035684"><span class="annot"><span class="annottext">Instruction pu
</span><a href="#local-6989586621680035684"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f [ProcessStepID] -&gt; f ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(f [ProcessStepID] -&gt; f ()) -&gt; f [ProcessStepID] -&gt; f ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; Instruction pu -&gt; f [ProcessStepID]
forall pu v x t (m :: * -&gt; *).
(MonadState (Schedule pu v x t) m, Show (Instruction pu),
 Typeable pu, Num t) =&gt;
Interval t -&gt; Instruction pu -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleInstructionUnsafe"><span class="hs-identifier hs-var">scheduleInstructionUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035685"><span class="hs-identifier hs-var">ti</span></a></span><span> </span><span class="annot"><span class="annottext">Instruction pu
</span><a href="#local-6989586621680035684"><span class="hs-identifier hs-var">instr</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-comment">-- |Add to the process description information about nested step.</span><span>
</span><span id="line-180"></span><span id="scheduleNestedStep"><span class="annot"><span class="annottext">scheduleNestedStep :: tag -&gt; Step t (StepInfo v x t) -&gt; m ProcessStepID
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleNestedStep"><span class="hs-identifier hs-var hs-var">scheduleNestedStep</span></a></span></span><span> </span><span id="local-6989586621680035683"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680035683"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680035682"><span class="annot"><span class="annottext">step :: Step t (StepInfo v x t)
</span><a href="#local-6989586621680035682"><span class="hs-identifier hs-var">step</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span class="hs-special">{</span><span id="local-6989586621680035681"><span class="annot"><span class="annottext">Interval t
pInterval :: forall t i. Step t i -&gt; Interval t
pInterval :: Interval t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#pInterval"><span class="hs-identifier hs-var hs-var">pInterval</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621680035679"><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035679"><span class="hs-identifier hs-var">pID</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ProcessStepID -&gt; Step t (StepInfo v x t)) -&gt; m [ProcessStepID]
forall (m :: * -&gt; *) pu v x t.
MonadState (Schedule pu v x t) m =&gt;
(ProcessStepID -&gt; Step t (StepInfo v x t)) -&gt; m [ProcessStepID]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleStep%27"><span class="hs-identifier hs-var">scheduleStep'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680035678"><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035678"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ProcessStepID
-&gt; Interval t -&gt; StepInfo v x t -&gt; Step t (StepInfo v x t)
forall t i. ProcessStepID -&gt; Interval t -&gt; i -&gt; Step t i
</span><a href="NITTA.Model.ProcessorUnits.Types.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessStepID
</span><a href="#local-6989586621680035678"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680035681"><span class="hs-identifier hs-var">pInterval</span></a></span><span> </span><span class="annot"><span class="annottext">(StepInfo v x t -&gt; Step t (StepInfo v x t))
-&gt; StepInfo v x t -&gt; Step t (StepInfo v x t)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; Step t (StepInfo v x t) -&gt; StepInfo v x t
forall tag t v x.
UnitTag tag =&gt;
tag -&gt; Step t (StepInfo v x t) -&gt; StepInfo v x t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#NestedStep"><span class="hs-identifier hs-var">NestedStep</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680035683"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Step t (StepInfo v x t)
</span><a href="#local-6989586621680035682"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ProcessStepID] -&gt; ProcessStepID
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ProcessStepID
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035679"><span class="hs-identifier hs-var">pID</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessStepID -&gt; ProcessStepID -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ProcessStepID
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; m ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scheduleNestedStep internal error.&quot;</span></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">ProcessStepID -&gt; m ProcessStepID
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ProcessStepID -&gt; m ProcessStepID)
-&gt; ProcessStepID -&gt; m ProcessStepID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ProcessStepID] -&gt; ProcessStepID
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[ProcessStepID]
</span><a href="#local-6989586621680035679"><span class="hs-identifier hs-var">pID</span></a></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- |Get a current slice of the computational process.</span><span>
</span><span id="line-186"></span><span id="local-6989586621680035668"><span id="local-6989586621680035669"><span id="local-6989586621680035670"><span id="local-6989586621680035671"><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#getProcessSlice"><span class="hs-identifier hs-type">getProcessSlice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-type">Schedule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035671"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035670"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035669"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035668"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Process"><span class="hs-identifier hs-type">Process</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035668"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#StepInfo"><span class="hs-identifier hs-type">StepInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035670"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035669"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035668"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-187"></span><span id="getProcessSlice"><span class="annot"><span class="annottext">getProcessSlice :: State (Schedule pu v x t) (Process t (StepInfo v x t))
</span><a href="NITTA.Utils.ProcessDescription.html#getProcessSlice"><span class="hs-identifier hs-var hs-var">getProcessSlice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#Schedule"><span class="hs-identifier hs-type">Schedule</span></a></span><span class="hs-special">{</span><span id="local-6989586621680035667"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
schProcess :: Process t (StepInfo v x t)
schProcess :: forall pu v x t. Schedule pu v x t -&gt; Process t (StepInfo v x t)
</span><a href="#local-6989586621680035667"><span class="hs-identifier hs-var hs-var">schProcess</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT (Schedule pu v x t) Identity (Schedule pu v x t)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
-&gt; State (Schedule pu v x t) (Process t (StepInfo v x t))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680035667"><span class="hs-identifier hs-var">schProcess</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- |Helper for instruction extraction from a rigid type variable.</span><span>
</span><span id="line-192"></span><span id="local-6989586621680035665"><span id="local-6989586621680035666"><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#castInstruction"><span class="hs-identifier hs-type">castInstruction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621680035666"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621680035665"><span class="hs-identifier hs-type">pu</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680035665"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680035666"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035665"><span class="hs-identifier hs-type">pu</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-193"></span><span id="castInstruction"><span class="annot"><span class="annottext">castInstruction :: pu -&gt; a -&gt; Maybe (Instruction pu)
</span><a href="NITTA.Utils.ProcessDescription.html#castInstruction"><span class="hs-identifier hs-var hs-var">castInstruction</span></a></span></span><span> </span><span id="local-6989586621680035664"><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680035664"><span class="hs-identifier hs-var">_pu</span></a></span></span><span> </span><span id="local-6989586621680035663"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680035663"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe (Instruction pu)
forall a b. (Typeable a, Typeable b) =&gt; a -&gt; Maybe b
</span><span class="hs-identifier hs-var">cast</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680035663"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-194"></span></pre></body></html>